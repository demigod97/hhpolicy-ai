# Story 1.3: Administrator Document Upload

## Status
Draft

## Story
**As an** Administrator,
**I want** to upload a policy document,
**so that** it can be stored and processed by the system.

## Acceptance Criteria
1. The UI provides an interface for selecting and uploading a file (e.g., PDF, TXT).
2. The uploaded file is successfully stored in Supabase Storage.
3. A new record is created in the `policy_documents` table, linked to the Administrator's user ID.
4. The document's initial processing status is set to 'processing'.

## Tasks / Subtasks
- [ ] Task 1: Create Document Upload UI (AC: 1)
  - [ ] Create file upload component with drag-and-drop support
  - [ ] Add file type validation (PDF, TXT)
  - [ ] Add file size limits and validation
  - [ ] Create upload progress indicator
- [ ] Task 2: Implement File Storage (AC: 2)
  - [ ] Set up Supabase Storage bucket for policy documents
  - [ ] Create storage upload function
  - [ ] Handle file upload errors and edge cases
  - [ ] Implement file naming convention
- [ ] Task 3: Create Database Record (AC: 3, 4)
  - [ ] Create function to insert policy_document record
  - [ ] Link document to current user ID
  - [ ] Set initial processing status to 'processing'
  - [ ] Add error handling for database operations
- [ ] Task 4: Integrate Upload Flow
  - [ ] Connect UI to storage and database functions
  - [ ] Add success/error feedback to user
  - [ ] Update document list after successful upload
  - [ ] Add loading states and error handling

## Dev Notes

### File Upload Requirements
- **Supported Formats**: PDF, TXT files
- **File Size Limits**: Reasonable limits to prevent abuse
- **Storage Location**: Supabase Storage with organized folder structure
- **Security**: Files should be private to the uploading user initially

### UI/UX Considerations
- **Drag and Drop**: Modern file upload experience
- **Progress Feedback**: Show upload progress to user
- **Error Handling**: Clear error messages for failed uploads
- **File Validation**: Client-side validation before upload

### Database Integration
- **Table**: `policy_documents` (created in Story 1.2)
- **Required Fields**: user_id, title, role_assignment, processing_status
- **Status Flow**: 'processing' â†’ 'completed' (handled in Story 1.4)

### Key Files to Create/Modify
- `src/components/policy-document/FileUpload.tsx` - New upload component
- `src/hooks/useFileUpload.tsx` - Upload logic hook
- `src/services/documentService.ts` - Document management service
- `supabase/functions/upload-document.ts` - Server-side upload function
- `src/pages/Dashboard.tsx` - Add upload functionality to dashboard

### Storage Structure
```
policy-documents/
  {user_id}/
    {document_id}/
      original.{ext}
      metadata.json
```

### Testing
- **Unit Tests**: Test upload component and validation logic
- **Integration Tests**: Test file upload to Supabase Storage
- **E2E Tests**: Test complete upload flow from UI to database
- **Error Tests**: Test various failure scenarios

## Change Log
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-01-17 | 1.0 | Initial story creation from PRD | Sarah (PO) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*Results from QA Agent review will be added here*
